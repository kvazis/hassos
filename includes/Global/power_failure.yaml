power_failure:

    recorder:
      include:
        entities:
           - binary_sensor.lr_electricity
           - binary_sensor.kn_electricity
           - binary_sensor.electricity

    homeassistant:
      customize:

        binary_sensor.lr_electricity:
          friendly_name: Сенсор электричества гостиная
          icon: mdi:home-lightning-bolt-outline

        binary_sensor.kn_electricity:
          friendly_name: Сенсор электричества кухня
          icon: mdi:home-lightning-bolt-outline

        binary_sensor.electricity:
          friendly_name: Электропитание
          icon: mdi:transmission-tower

        binary_sensor.0xa4c138bae3526a07_contact:
          friendly_name: Сенсор определения отключения гостиная
          device_class: problem
        sensor.0xa4c138bae3526a07_battery:
          friendly_name: Сенсор определения отключения гостиная
          
        binary_sensor.0xa4c138744bf2fbf0_contact:
          friendly_name: Сенсор определения отключения кухня
          device_class: problem
        sensor.0xa4c138744bf2fbf0_battery:
          friendly_name: Сенсор определения отключения кухня

    template:
    
      - binary_sensor:

    # Сенсор определения отключения гостиная
          - name: lr_electricity
            unique_id: lr_electricity
            state: >
             {{ is_state('binary_sensor.0xa4c138bae3526a07_contact', 'on') }}
            device_class: problem

    # Сенсор залипание сенсора отключения гостиная
          - name: lr_electricity_reset
            unique_id: lr_electricity_reset
            state: >
             {{ is_state('binary_sensor.0xa4c138bae3526a07_contact', 'on') and
                 is_state('switch.0xa4c138cd1b6a0a9a', 'on')  }}
            delay_on: 
                minutes: 5
            device_class: problem

    # Сенсор определения отключения кухня
          - name: kn_electricity
            unique_id: kn_electricity
            state: >
             {{ is_state('binary_sensor.0xa4c138744bf2fbf0_contact', 'on') }}
            device_class: problem

    # Сенсор определения отключения электрики
          - name: electricity
            unique_id: electricity
            state: >
             {{ is_state('binary_sensor.lr_electricity', 'on') 
                and is_state('binary_sensor.kn_electricity', 'on')
             }}
            device_class: problem

    automation:           
#################### ПЕРЕЗАГРУЗКА СЕНСОРОВ ЭЛЕКТРИКИ ####################
              
      - alias: electricity_reboot_lr_sensor
        id: electricity_reboot_lr_sensor
        description: Электрика - перезагрузка сенсора в гостиной
        initial_state: true
        trigger:
    # Проверка раз в 5 минут, перезагрузка если сенсор залип
        - platform: time_pattern
          minutes: '/5'
        condition:
    # Переключатель режима работы сервера
        - condition: state
          entity_id: switch.control_mode
          state: 'on'
    # Сенсор определяющий недоступность люстры
        - condition: state
          entity_id: binary_sensor.lr_electricity_reset
          state: 'on'
        action:
    # Перезагрузка по питанию
        - service: switch.turn_off
          entity_id: switch.0xa4c138cd1b6a0a9a
        - delay: 00:00:05
        - service: switch.turn_on
          entity_id: switch.0xa4c138cd1b6a0a9a